{% extends 'core/base.html' %}

{% block content %}
<div class="container">
    <h1 style="text-align: center; margin-bottom: 2rem; background: linear-gradient(45deg, #6a11cb, #2575fc); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">–°–µ–∞–Ω—Å—ã</h1>

    <!-- –ü–æ–∏—Å–∫ -->
    <div class="search-box">
        <form method="get">
            <input type="text" name="search" class="search-input" placeholder="–ü–æ–∏—Å–∫ —Ñ–∏–ª—å–º–æ–≤..." value="{{ request.GET.search }}">
            <button type="submit" style="position: absolute; right: 10px; top: 50%; transform: translateY(-50%); background: none; border: none; color: #fff; cursor: pointer;">üîç</button>
        </form>
    </div>

    <!-- –°–µ—Ç–∫–∞ —Ñ–∏–ª—å–º–æ–≤ -->
    <div class="movie-grid">
        {% for session in sessions %}
        <div class="movie-card">
            {% if session.image %}
                <img src="{{ session.image.url }}" alt="{{ session.title }}" class="movie-poster">
            {% else %}
                <div class="no-poster" style="height: 400px; background: linear-gradient(45deg, #2d3047, #1a1a2e); display: flex; align-items: center; justify-content: center; color: #6a11cb; font-size: 1.2rem; font-weight: bold;">
                    üé¨ –ù–µ—Ç –ø–æ—Å—Ç–µ—Ä–∞
                </div>
            {% endif %}

            <div class="movie-info">
                <h3 style="color: #fff; margin-bottom: 0.5rem;">{{ session.title }}</h3>
                <p style="color: #aaa; margin-bottom: 1rem; font-size: 0.9rem;">
                    {{ session.description|truncatewords:20 }}
                </p>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem; margin-bottom: 1rem;">
                    <div>
                        <small style="color: #fff;">üìÖ –î–∞—Ç–∞</small>
                        <p style="color: #fff; font-size: 0.9rem;">{{ session.date|date:"d.m.Y H:i" }}</p>
                    </div>
                    <div>
                        <small style="color: #fff;">‚è± –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å</small>
                        <p style="color: #fff; font-size: 0.9rem;">{{ session.duration }} –º–∏–Ω.</p>
                    </div>
                    <div>
                        <small style="color: #fff;">üí∞ –¶–µ–Ω–∞</small>
                        <p style="color: #fff; font-size: 0.9rem;">{{ session.price }} —Ä—É–±.</p>
                    </div>
                    <div>
                        <small style="color: #fff;">üéü –ú–µ—Å—Ç–∞</small>
                        <p style="color: #fff; font-size: 0.9rem;">{{ session.seats_available }}</p>
                    </div>
                </div>

                {% if user.is_authenticated and not user.is_staff %}
                    {% if session.seats_available > 0 %}
                        <a href="{% url 'book_session' session.id %}" class="btn" style="width: 100%; text-align: center;">–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å</a>
                    {% else %}
                        <button class="btn" style="width: 100%; background: #ff2e63; cursor: not-allowed;" disabled>–ù–µ—Ç –º–µ—Å—Ç</button>
                    {% endif %}
                {% endif %}
            </div>
        </div>
        {% empty %}
        <div style="grid-column: 1 / -1; text-align: center; padding: 2rem; color: #aaa;">
            <p>–°–µ–∞–Ω—Å—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>
        </div>
        {% endfor %}
    </div>

    <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è -->
    {% if sessions.has_other_pages %}
    <div class="pagination">
        {% if sessions.has_previous %}
            <a href="?page={{ sessions.previous_page_number }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}" class="page-link">‚Üê –ù–∞–∑–∞–¥</a>
        {% endif %}

        <span style="color: #fff; padding: 0.5rem 1rem;">
            –°—Ç—Ä–∞–Ω–∏—Ü–∞ {{ sessions.number }} –∏–∑ {{ sessions.paginator.num_pages }}
        </span>

        {% if sessions.has_next %}
            <a href="?page={{ sessions.next_page_number }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}" class="page-link">–í–ø–µ—Ä–µ–¥ ‚Üí</a>
        {% endif %}
    </div>
    {% endif %}
</div>
{% endblock %}